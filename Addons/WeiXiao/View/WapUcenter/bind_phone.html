	<include file="Home@Public/mobile_head_mui"/>
	<script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
	<style>
		.mui-row .mui-btn {
			margin-top: 3px;
			width: 120px;
		}
		.ucenter-btn {
			margin-top: 3px;
		}

		#send_btn {
			display: none;
		}

		#code_input {
			display: none;
		}
		#captha_label {
			display: none;
		}

	</style>

	<body style="background: #efeff4;">
		<div class="mui-content">
			<header class="mui-bar mui-bar-nav header">
				<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left" href="material_list.html"></a>
				<a class="mui-icon mui-icon-bars mui-pull-right" href="javascript:;" id="menu-btn"></a>
				<h1 class="mui-title"><a href=""><img src="{:ADDON_PUBLIC_PATH}/MUI/images/haha_logo.png"/></a></h1>
			</header>
			<!--显示下拉-->
			<div id="menu-wrapper" class="menu-wrapper ">
				<div id="menu" class="menu">
					<a class="current" href="index.html">首页</a>
					<a href="evaluation.html">测评</a>
					<a href="special.html">专题</a>
					<a href="ranking.html">排行榜</a>
					<a href="category.html">类别</a>
				</div>
			</div>
			<div id="menu-backdrop" class="menu-backdrop"></div>

			<div class="mui-content">
				<ul class="mui-table-view mui-grid-view ucenter-profile-head">
					<li class="mui-table-view-cell mui-col-sm-12 mui-col-xs-12">
					</li>
					<li class="mui-table-view-cell  mui-col-sm-2 mui-col-xs-3">
						<empty name="user['headimgurl']">
							<img class="ucenter-avatar-icon" src="__STATIC__/face/default_head.png">
							<else/>
							<img class="ucenter-avatar-icon" src="{$user['headimgurl']}">
						</empty>
					</li>
					<li class="mui-table-view-cell  mui-col-sm-2 mui-col-xs-3">
						<p class="ucenter-user-nick">{$user['nickname']}</p>
					</li>
					<li class="mui-table-view-cell mui-col-sm-3 mui-col-xs-4">
						<p class="ucenter-user-nick">ID {$user['uid']}</p>
					</li>
					<li class="mui-table-view-cell mui-col-sm-12 mui-col-xs-12">
						<if condition="$user['has_subscribe'] neq 1">
							<p class="ucenter-user-nick">你尚未关注{$school}微校公众号，为获取更多功能服务，请尽快关注</p>
						</if>
					</li>
				</ul>

				<div class="mui-content-padded" style="margin: 5px;">
					<form class="mui-input-group" method="post" action="{:addons_url('WeiXiao://WapUcenter/bind_phone')}">

						<div class="mui-input-row">
							<input id="mobile" name="mobile" type="text" placeholder="手机号码" value="{$user['mobile']}">
						</div>
						<div id="captha_input" class="mui-input-row mui-row">
							<div class="mui-col-sm-6 mui-col-xs-6">
								<input type="text" value="" name="captha" class="mui-input-clear" placeholder="拼图验证" disabled>
							</div>
							<div class="mui-col-sm-5 mui-col-xs-5">
								<button id="TencentCaptcha"
										data-appid="2088073676"
										data-cbfn="captcha_cb" type="button"
										class="mui-btn mui-btn-primary mui-btn-outlined mui-text-center">拼图验证</button>
							</div>
							<div class="mui-col-sm-1 mui-col-xs-1">
							</div>
						</div>
						<div id="captha_label" class="mui-input-row mui-row">
							<div class="mui-col-sm-12 mui-col-xs-12">
								<input type="text" value="" name="captha_OK" class="mui-input-clear" placeholder="图案验证通过，请继续手机验证码验证：" disabled>
							</div>
						</div>
						<div class="mui-input-row mui-row">
							<div class="mui-col-sm-6 mui-col-xs-6">
								<input id="code_input" type="text" value="" name="code" class="mui-input-clear" placeholder="手机验证码">
							</div>
							<div class="mui-col-sm-5 mui-col-xs-5">
								<button id="send_btn" type="button" class="mui-btn mui-btn-primary mui-btn-outlined mui-text-center" onclick="sendmsg()">获取验证码
								</button>
							</div>
							<div class="mui-col-sm-1 mui-col-xs-1">
							</div>
						</div>
						<div class="mui-button-row">
						</div>
						<div class="mui-button-row">
							<input value="" name="verify_ticket" type="hidden">
							<input value="" name="verify_randstr" type="hidden">
							<button type="submit" class="mui-btn mui-btn-primary">确认</button>&nbsp;&nbsp;
							<button type="button" class="mui-btn mui-btn-danger" >取消</button>
						</div>
						<div class="mui-button-row">
						</div>
					</form>

				</div>

			</div>
			<div class="mui-card">
				<div class="mui-card-header ucenter-small-title">
					<!--专题推荐-->
					<span>热门课程</span>
					<a href="">显示全部<i class="mui-icon mui-icon-arrowright"></i></a>
				</div>
				<div class="mui-card-content">
					<div class="mui-slider">
						<div class="mui-slider-group mui-slider-loop">
							<!-- 额外增加的一个节点(循环轮播：第一个节点是最后一个图文表格) -->
							<div class="mui-slider-item mui-slider-item-duplicate">
								<ul class="mui-table-view mui-grid-view">
									<li class="mui-table-view-cell mui-media mui-col-xs-6">
										<a href="#"><img class="mui-media-object" src="{:ADDON_PUBLIC_PATH}/MUI/images/tj.png">
										</a>
									</li>
									<li class="mui-table-view-cell mui-media mui-col-xs-6">
										<a href="#"><img class="mui-media-object" src="{:ADDON_PUBLIC_PATH}/MUI/images/tj1.png">
										</a>
									</li>
								</ul>
							</div>
							<div class="mui-slider-item">
								<ul class="mui-table-view mui-grid-view">
									<li class="mui-table-view-cell mui-media mui-col-xs-6">
										<a href="#"><img class="mui-media-object" src="{:ADDON_PUBLIC_PATH}/MUI/images/tj2.jpg">
										</a>
									</li>
									<li class="mui-table-view-cell mui-media mui-col-xs-6">
										<a href="#"><img class="mui-media-object" src="{:ADDON_PUBLIC_PATH}/MUI/images/tj4.png">
										</a>
									</li>
								</ul>
							</div>
							<div class="mui-slider-item mui-slider-item-duplicate">
								<ul class="mui-table-view mui-grid-view">
									<li class="mui-table-view-cell mui-media mui-col-xs-6">
										<a href="#"><img class="mui-media-object" src="{:ADDON_PUBLIC_PATH}/MUI/images/tj.png">
										</a>
									</li>
									<li class="mui-table-view-cell mui-media mui-col-xs-6">
										<a href="#"><img class="mui-media-object" src="{:ADDON_PUBLIC_PATH}/MUI/images/tj1.png">
										</a>
									</li>
								</ul>
							</div>
							<div class="mui-slider-item">
								<ul class="mui-table-view mui-grid-view">
									<li class="mui-table-view-cell mui-media mui-col-xs-6">
										<a href="#"><img class="mui-media-object" src="{:ADDON_PUBLIC_PATH}/MUI/images/tj2.jpg">
										</a>
									</li>
									<li class="mui-table-view-cell mui-media mui-col-xs-6">
										<a href="#"><img class="mui-media-object " src="{:ADDON_PUBLIC_PATH}/MUI/images/tj4.png">
										</a>
									</li>
								</ul>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<script type="text/javascript " src="{:ADDON_PUBLIC_PATH}/MUI/js/app.js "></script>
		<script type="text/javascript ">
			var verify_res;
            window.captcha_cb = function(res){
                console.log(res)
                // res（未通过验证）= {ret: 1, ticket: null}
                // res（验证成功） = {ret: 0, ticket: "String", randstr: "String"}
                if(res.ret === 0){
                    //alert(res.ticket);   // 票据
					$('input[name="verify_ticket"]').attr("value", res.ticket);
                    $('input[name="verify_randstr"]').attr("value", res.randstr);
                    verify_res = res;
					$('input[name="code"]').show();
                    $('#send_btn').show();
                    $('#captha_label').show();
                    $('#captha_input').hide();
                }
            }

			mui.init();

            var reSentTime = 60;

            function sendmsg(){
                if($('#send_btn').hasClass('gray_btn'))return;
                if($('input[name="mobile"]').size()>0 && $('input[name="mobile"]').val().length!=11){
                    mui.toast('请输入正确的手机号码!');
                    return;
                }

                $('#send_btn').addClass('gray_btn');
                reSentTime = 60;
                show_time();

                var hash = "";
                if ($('input[name="__hash__"]').size()>0) {
                    hash = $('input[name="__hash__"]').val()
                }
                var mobile = $('#mobile').val();
                var url = "{:U('Home/Index/sendMsg')}";
                //var verify_ticket = $('input[name="verify_ticket"]').val();
                //var verify_randstr = $('input[name="verify_randstr"]').val();

				$.post(url,{mobile:mobile, __hash__:hash, verify_ticket:verify_res.ticket, verify_randstr:verify_res.randstr},function(res){
					return;
					//TODO
					/*console.log("HASH is: ", hash);
					 console.log("Return is: ", res);*/
				});

            }
            function show_time(){
                if(reSentTime > 0){
                    --reSentTime;
                    $('#send_btn').html(reSentTime+'秒后可重发');
                    setTimeout("show_time()", 1000); //设置1000毫秒以后执行一次本函数
                }else{
                    reSentTime = 60;
                    $('#send_btn').html('重新发送验证码');
                    $('#send_btn').removeClass('gray_btn');
                }
            };


            $('#submit').click(function(){
                // $('#form').submit();
                //判断
                if($('input[name="mobile"]').size()>0 && $('input[name="mobile"]').val().length!=11){
                    mui.toast('请输入正确的手机号码!');
                    return;
                }


                //$.Dialog.loading();
                $.ajax({
                    url:'{$post_url}',
                    type:'post',
                    data:$('#form').serializeArray(),
                    dataType:'json',
                    success:function(json){
                        console.log(json);
                        //$.Dialog.close();
                        if(json.status==1){

                            mui.toast(json.info);
                            //alert('2');
                        }else{
                            mui.toast(json.info);
                            //alert('3');
                        }
                        if(json.url!=""){
                            setTimeout(function(){
                                window.location.href=json.url;
                            },2000);
                        }
                    },
                    error:function(){
                        mui.toast("出错啦！");
						//$.Dialog.close();
                        //$.Dialog.fail();
                    }
                });
            });
		</script>
	</body>

</html>